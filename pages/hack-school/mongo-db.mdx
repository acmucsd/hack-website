# Week 5: Databases and MongoDB

## What is a Database?
A database is an organized collection of data or information. It allows people to store information between sessions on a website.
Data in a database is organized in a way to make it easy to write, manage, and update the data.

## SQL
![sql](pages/hack-school/images/sql.png)

One type of database is a SQL (**S**tructured **Q**uery **L**anguage) database. SQL is a programming language to store and process information
in a relational database. A relational database uses tables to store information, using rows and columns. It looks similar to popular spreadsheet programs
like Google Sheets and Microsoft Excel. Popular database management platforms that uses SQL are PostgreSQL and MySQL.

**Some popular SQL commands include:** 
| Command    | Use |
| -------- | ------- |
| SELECT  | extracts data from database    |
| UPDATE | updates data in database     |
| DELETE    | deletes data from database    |
| INSERT INTO   | inserts data into database    |
| CREATE DATABASE   | creates new database    |
| CREATE TABLE   | creates new table   |


## NoSQL
```
// Example of a document with user information
{
     "_id": 1,
     "first_name": "Angela",
     "college": "Marshall",
     "year": "2nd year",
     "likes": [
        "food",
        "kpop",
        "ACM"
     ]
  }
```
The main type of database that this chapter focuses on is a NoSQL (non-SQL) database. Instead of storing data in
a tabular format, NoSQL databases usually order data using **documents**. Documents store data in key-value pairs.
The values can be strings, numbers, arrays, or objects while the keys are unique identifiers (usually strings) for the values.
These documents are typically stored as JSON, BSON, or XML files. JSON (JavaScript Object Notation) is a text-based format
for structured data which is based on Javascript object syntax. 

## MongoDB
MongoDB is a free and open-source NoSQL database management program with data in collections of documents. 
It uses BSON which is a binary encoded JSON-like documents. However, it runs locally on the user's device
which means that the user has to set up, manage, and deploy the database. 

## MongoDB Atlas
MongdoDB Atlas is a cloud database service that deploys and manages a database for you.

### Creating MongoDB Atlas Database
1. Create an account on [MongoDB](https://account.mongodb.com/account/login)
2. Once logged in, navigate to the **Database Deployments** page and click on the **Build a Database** button 
3. Choose the M0 (free) option and customize name for the cluster
4. Authenticate the connection with a username and password and add your ip address to whitelist it
5. Connect to the database with the Node.js driver and copy the connection string

### Connecting to MongoDB Atlas Database
1. After you copy the connection string, add it to an .env file (hides it from public)
2. In a js file, add the following code snippet
```js copy
const mongoose = require('mongoose');

mongoose.connect(config.databaseUrl, {
    useNewUrlParser: true,
    useUnifiedTopology: true }).then(() => {
  console.log('Connected to MongoDB database');
});
```
Learn more at [Get Started With Atlas](https://www.mongodb.com/docs/atlas/getting-started/) on MongoDB!

## Mongoose
Mongoose is a JavaScript library that wraps MongoDB with a schema-based approach. Schemas are blueprints for
the data. Using these schemas, we can create models which help us create and read documents. Install
the library with npm. 
```
npm install mongoose
```

## Defining Schemas
```js copy
const userSchema = new Schema({
  id: Number,
  first_name: String,
  college: String,
  year: String,
  likes: [[String]]
});
```
To create a schema, Mongoose uses keys with property types aka SchemaTypes.
Valid SchemaTypes include: 
- String
- Number
- Date
- Buffer
- Boolean
- Mixed
- ObjectId
- Array
- Decimal128
- Map
- Schema
- UUID
- BigInt

## CRUD Operations
CRUD (**C**reate **R**ead **U**pdate **D**elete) Operations are four basic operations for any application with a database.

### Create
Create operations add a new document to the database. 
```js copy
// Create a new user from the given object
const newUser = {
    "_id": 2,
     "first_name": "Angela",
     "college": "Marshall",
     "year": "2nd year",
     "likes": [
        "food",
        "kpop",
        "ACM"
     ]
};
User.create(newUser);
```

### Read
Read operations allow us to get data from the database. They can also filter based on queries.
```js copy
// Find all purchases
Purchase.find().exec();

// Find a purchase by id
Purchase.findById(id).exec();
```

### Update
Update operations are similar to create operations, but modify existing documents
```js copy
// update first document where 'a' is 1
// set 'a' to 2 instead
db.collection('example').updateOne({a: 1},
    {$set: {a: 2}});

// update ALL document where 'a' is 2
// add new field 'b'
db.collection('example').updateMany({a: 2},
    {$set: {b: 2}});

// create the document if it doesn't exist
db.collection('example').updateOne({a: 4},
    {$set: {b: 4}}, {upsert: true});
```

### Delete
Delete operations remove documents from the database. 
```js copy
// delete first iPhone in the database
Purchase.deleteOne({name: 'iPhone'});

// delete ALL electric types
Purchase.deleteMany({location: 'UTC'});
```